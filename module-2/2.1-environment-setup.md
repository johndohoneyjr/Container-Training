# Lab 2.1: Environment Setup for .NET Containerization

## Overview
In this lab, you'll set up your local development environment for .NET containerization. You'll install Docker Desktop and ORAS CLI, configure them properly, and verify everything is working correctly.

## Prerequisites
- Administrator/sudo access on your machine
- Stable internet connection
- At least 4GB of free RAM (8GB recommended)
- 20GB of free disk space

---

## Part 1: Installing Docker Desktop

### Windows Installation (WSL2)

#### System Requirements
- Windows 10 64-bit: Pro, Enterprise, or Education (Build 19041 or higher)
- OR Windows 11 64-bit
- WSL 2 feature enabled
- Virtualization enabled in BIOS

#### Step-by-Step Installation

1. **Enable WSL 2**
   
   Open PowerShell as Administrator and run:
   
   ```powershell
   wsl --install
   ```
   
   Restart your computer when prompted.

2. **Download Docker Desktop**
   
   Visit [https://www.docker.com/products/docker-desktop](https://www.docker.com/products/docker-desktop) and download Docker Desktop for Windows.

3. **Install Docker Desktop**
   
   - Run the installer (Docker Desktop Installer.exe)
   - Ensure "Use WSL 2 instead of Hyper-V" is checked
   - Follow the installation wizard
   - Restart your computer when installation completes

4. **Configure Docker Desktop**
   
   - Launch Docker Desktop
   - Accept the Docker Subscription Service Agreement
   - Sign in or skip (you can sign in later)
   - Go to Settings → Resources → WSL Integration
   - Enable integration with your default WSL 2 distro
   - Apply & Restart

5. **Optimize Settings**
   
   Go to Settings → Resources and configure:
   - **CPUs**: Allocate at least 2 cores (4 recommended)
   - **Memory**: Allocate at least 4GB (8GB recommended)
   - **Disk image size**: Set to 40GB or more

---

### macOS Installation

#### System Requirements
- macOS 11 or newer
- Apple Silicon (M1/M2/M3) or Intel processor
- At least 4GB of RAM

#### Step-by-Step Installation

1. **Download Docker Desktop**
   
   Visit [https://www.docker.com/products/docker-desktop](https://www.docker.com/products/docker-desktop)
   
   - For **Apple Silicon** (M1/M2/M3): Download "Mac with Apple chip"
   - For **Intel Macs**: Download "Mac with Intel chip"

2. **Install Docker Desktop**
   
   ```bash
   # Open the downloaded .dmg file
   # Drag Docker.app to Applications folder
   # Launch Docker from Applications
   ```

3. **Grant Permissions**
   
   - Docker will request privileged access
   - Enter your password to allow installation
   - Accept the Docker Subscription Service Agreement

4. **Configure Resources**
   
   Go to Docker Desktop → Settings → Resources:
   
   - **CPUs**: 4 (or half of your total cores)
   - **Memory**: 8GB
   - **Disk image size**: 40GB
   
   Click "Apply & Restart"

---

### Linux Installation (Ubuntu/Debian)

#### Step-by-Step Installation

1. **Update Package Index**
   
   ```bash
   sudo apt-get update
   ```

2. **Install Prerequisites**
   
   ```bash
   sudo apt-get install -y \
       ca-certificates \
       curl \
       gnupg \
       lsb-release
   ```

3. **Add Docker's Official GPG Key**
   
   ```bash
   sudo mkdir -p /etc/apt/keyrings
   curl -fsSL https://download.docker.com/linux/ubuntu/gpg | \
       sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
   ```

4. **Set Up the Repository**
   
   ```bash
   echo \
     "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
     https://download.docker.com/linux/ubuntu \
     $(lsb_release -cs) stable" | \
     sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
   ```

5. **Install Docker Engine**
   
   ```bash
   sudo apt-get update
   sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
   ```

6. **Post-Installation Steps (Enable Non-Root User)**
   
   ```bash
   # Create docker group
   sudo groupadd docker
   
   # Add your user to docker group
   sudo usermod -aG docker $USER
   
   # Activate changes to groups
   newgrp docker
   ```

7. **Enable Docker to Start on Boot**
   
   ```bash
   sudo systemctl enable docker.service
   sudo systemctl enable containerd.service
   ```

---

## Part 2: Verify Docker Installation

Run the following commands to verify Docker is installed correctly:

### 1. Check Docker Version

```bash
docker --version
```

**Expected Output:**
```
Docker version 24.0.7, build afdd53b
```

### 2. Check Docker Info

```bash
docker info
```

**Expected Output:**
```
Client:
 Context:    default
 Debug Mode: false

Server:
 Containers: 0
  Running: 0
  Paused: 0
  Stopped: 0
 Images: 0
 Server Version: 24.0.7
 Storage Driver: overlay2
 ...
```

### 3. Run Hello World Container

```bash
docker run hello-world
```

**Expected Output:**
```
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
...
Hello from Docker!
This message shows that your installation appears to be working correctly.
```

### 4. Check Docker Compose

```bash
docker compose version
```

**Expected Output:**
```
Docker Compose version v2.23.3
```

> **✅ Success Indicator**: If all four commands execute successfully, Docker is properly installed!

---

## Part 3: Installing ORAS CLI

### What is ORAS?

**ORAS** (OCI Registry As Storage) is a CLI tool for managing OCI artifacts in container registries. It enables you to:
- Store and retrieve any type of file in OCI-compliant registries
- Manage artifacts beyond container images (Helm charts, config files, ML models)
- Work with supply chain artifacts like SBOMs and signatures

### Windows Installation

#### Option 1: Using Winget (Recommended)

```powershell
winget install oras
```

#### Option 2: Using Chocolatey

```powershell
choco install oras
```

#### Option 3: Manual Installation

1. Download the latest release from: https://github.com/oras-project/oras/releases
2. Download `oras_x.x.x_windows_amd64.zip`
3. Extract to a directory (e.g., `C:\Program Files\oras`)
4. Add the directory to your PATH environment variable

---

### macOS Installation

#### Using Homebrew (Recommended)

```bash
brew install oras
```

#### Manual Installation

```bash
# Download the latest release
curl -LO https://github.com/oras-project/oras/releases/download/v1.1.0/oras_1.1.0_darwin_amd64.tar.gz

# Extract
tar -xzf oras_1.1.0_darwin_amd64.tar.gz

# Move to PATH
sudo mv oras /usr/local/bin/

# Make executable
sudo chmod +x /usr/local/bin/oras
```

---

### Linux Installation

#### Option 1: Using Package Manager (Ubuntu/Debian)

```bash
# Download and install
curl -LO https://github.com/oras-project/oras/releases/download/v1.1.0/oras_1.1.0_linux_amd64.tar.gz

tar -xzf oras_1.1.0_linux_amd64.tar.gz

sudo mv oras /usr/local/bin/

sudo chmod +x /usr/local/bin/oras
```

#### Option 2: Using Snap

```bash
sudo snap install oras --classic
```

---

## Part 4: Verify ORAS Installation

### 1. Check ORAS Version

```bash
oras version
```

**Expected Output:**
```
Version:        1.1.0
Go version:     go1.21.3
Git commit:     a1b2c3d4
Git tree state: clean
```

### 2. View ORAS Help

```bash
oras help
```

**Expected Output:**
```
oras - OCI Registry As Storage

Usage:
  oras [command]

Available Commands:
  attach      Attach files to an existing artifact
  copy        Copy artifacts from one location to another
  discover    Discover referrers of a manifest in a registry
  login       Log in to a remote registry
  logout      Log out from a remote registry
  manifest    Manifest operations
  pull        Pull files from a registry or an OCI image layout
  push        Push files to a registry or an OCI image layout
  repo        Repository operations
  tag         Tag a manifest in a registry
  version     Show the oras version information
...
```

### 3. Test ORAS with Docker Hub (Optional)

```bash
# Login to Docker Hub
oras login docker.io -u <your-username>

# Check connectivity
oras repo tags docker.io/library/hello-world
```

> **✅ Success Indicator**: If you see version information and help commands, ORAS is properly installed!

---

## Part 5: Quick Reference Commands

### Docker Commands Cheat Sheet

```bash
# Container Management
docker ps                    # List running containers
docker ps -a                 # List all containers
docker stop <container>      # Stop a container
docker start <container>     # Start a container
docker rm <container>        # Remove a container
docker logs <container>      # View container logs

# Image Management
docker images                # List images
docker pull <image>          # Pull an image
docker build -t <tag> .      # Build an image
docker rmi <image>           # Remove an image
docker image prune           # Remove unused images

# System Commands
docker system df             # Show disk usage
docker system prune          # Clean up unused resources
docker info                  # Display system information
```

### ORAS Commands Cheat Sheet

```bash
# Authentication
oras login <registry>                    # Login to registry
oras logout <registry>                   # Logout from registry

# Artifact Operations
oras push <target> <file>                # Push artifact
oras pull <target>                       # Pull artifact
oras discover <target>                   # Discover referrers
oras repo tags <repository>              # List tags
oras manifest fetch <target>             # Fetch manifest

# Repository Operations
oras repo ls <registry>                  # List repositories
```

---

## Troubleshooting

### Docker Desktop Won't Start (Windows)

**Issue**: Docker Desktop fails to start or shows "Docker Desktop starting..." indefinitely.

**Solutions**:
1. Ensure WSL 2 is properly installed: `wsl --list --verbose`
2. Update WSL: `wsl --update`
3. Restart Docker Desktop as Administrator
4. Check virtualization is enabled in BIOS

### Permission Denied (Linux)

**Issue**: `docker: permission denied while trying to connect to the Docker daemon socket`

**Solution**:
```bash
sudo usermod -aG docker $USER
newgrp docker
```

### ORAS Command Not Found

**Issue**: `oras: command not found`

**Solution**:
- Verify ORAS is in your PATH
- On macOS/Linux: `echo $PATH` and check if `/usr/local/bin` is included
- On Windows: Check Environment Variables → System variables → Path

---

## Next Steps

Congratulations! You've successfully set up your environment for .NET containerization. In the next lab, you'll learn about .NET container images and explore the Microsoft Container Registry.

**Ready to proceed to**: [Lab 2.2: Understanding .NET Container Images](2.2-dotnet-images.md)

---

## Additional Resources

- [Docker Documentation](https://docs.docker.com/)
- [Docker Desktop Settings](https://docs.docker.com/desktop/settings/)
- [ORAS Documentation](https://oras.land/)
- [WSL 2 Installation Guide](https://docs.microsoft.com/en-us/windows/wsl/install)

---

*Lab created by Progress Software for the .NET Containerization and Azure Deployment course.*
